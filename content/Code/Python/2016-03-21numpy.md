Title: Numpy 使用小结  
Tags: numpy, python, 小结  
Modified: 2016-03-26 11:12:24

[ESLModel](https://github.com/littlezz/ESL-Model) 开发有一段时间了， 期间和numpy打了非常多的交道， 虐得我死去活来。  

于是抽空写一下关于numpy的总结吧。  

Intro
--------
介绍一些会混淆的东西

###vector vs matrix
vector是向量， 是一维的。 
matrix是二维以上的。  

```python
vec = np.array([1, 2, 3])

# method 1
mat = np.array([[1],[2],[3]])

# method 2
mat = vec.reshape((3, 1))

# mathod 3
np.array(range(16)).reshape((4,4))

print(vec.shape)
# output (3,)

print(mat.shape)
# output (3, 1)

``` 

1. 向量可以点乘矩阵， 反过来也可以， 结果是向量。
2. 向量可以点乘向量， 得到标量
3. 向量没有倒置
4. 矩阵使用下标的时候， 结果是向量， 使用slice 来查询的时候， 得到子矩阵。  


如果想要得到  单行的子矩阵  

```python  
mat = np.array(range(16)).reshape((4,4))

# 得到一行， 矩阵
mat[[1], :]

# 得到一列， 矩阵
mat[:,[1]]

# 得到第二列， 向量
mat[:, 2]

# 子矩阵
mat[:2, :2]

# 下标查询
mat[1, 2]
```   

###axis=1 vs axis=0
之前看官方的文档里面有说， 你要这样记：axis=0 是从上往下， axis=1 是从左往右处理。  

比如`np.sum(mat, axis=0)` 得到每一列从上到下的累加和. `axis=1` 的时候得到每一行的累加和.  

```python  
m2 = np.array(range(12)).reshape((3,4))
np.sum(m2, axis=1)


Out[65]:
array([ 6, 22, 38])

```
####rowvar=1
在使用`np.cov` 的时候，里面有这个参数， 默认是非零， 表示你的矩阵是（p x N）的， 每一行表示变量， 每一列里面存的是样本数据。  如果`rowvar=0`, 则表示反过来.  


Tips
-----
###reshape
reshape 里面的值设置-1的时候表示自动

```python
np.array(range(12)).reshape((-1, 4))
  
```
会自动变成(3x4)  

###如何插入一列

```python
np.array(range(12)).reshape((-1, 4))
# 在0的开始插入全为3的列
b1 = np.insert(b, 0, 3,axis=1)
```

###如何把向量转成单列矩阵
```python
# column matrix
vec[:, None]

# row matrix
vec[None, :]
```

###如何算矩阵的行列式$|A|$  


用`np.linalg.det` 或者 `np.linalg.slogdet`
后者在矩阵里面的值很小的时候使用, 得到的是log后的结果.

###ddof
在`np.std`等函数中有`ddof`这个参数， 默认为0， 在pandas里面默认为1， 主要用于控制比如计算标准差的时候， 是除以N-1还是除以N， 这里相当于除以（N - ddof）

###svd
```python
U, D, Vt = np.linalg.svd(b)
print(U.shape, D.shape, Vt.shape, b.shape)
# output(4, 4) (3,) (3, 3) (4, 3)

# with full_matrices=False
U, D, Vt = np.linalg.svd(b, full_matrices=False)
print(U.shape, D.shape, Vt.shape, b.shape)
# output (4, 3) (3,) (3, 3) (4, 3)
```  
注意到D是向量， Vt是V的转置矩阵。
多数情况下， 应该是使用full_matrices=False

###随机整数矩阵
```python
# 随机生成包含0-9的 4x3 的矩阵
d=np.random.randint(10, size=(4,3))
```

###随机生成正交矩阵（orthogonal matrix）

```python
def generate_orthogonal_matrix(N):
    """
    with random permutation of coordinate axes
    :param N: dimension of matrix
    :return: NxN orthogonal matrix contains 0 and 1

    Ref: http://stackoverflow.com/questions/33003341/how-to-randomly-generate-a-nonnegative-orthogonal-matrix-in-numpy
    """
    I = np.eye(N)
    p = np.random.permutation(N)
    return I[p]
```

###特征分解（eigen decomposition）
`np.eigh` 针对对称的矩阵， **注意， eigenvalues 是升序的，而在R语言里面是降序的！**  
`np.eig` 普通的分解， eigenvalues不保证顺序。  

 





