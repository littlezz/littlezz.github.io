TITLE: Logging 使用总结  
TAGS: python, 小结   


###总览


logging 分为3大模块，`Logger`, `Handler`, 同时还有`Format`来控制输出的格式。  

logger 用于在应用中产生 log 信息实例， 这个信息之后会被 handler 处理， 用于分配 log 信息记录的位置， 比如是打印到屏幕上还是存放到文件中，一个log 信息可以被多个 handler 处理， 即， 一个 logger 可以有零个多个 handler。  
logger 和 handler 都有独立的记录等级， 只有在这个等级之上的信息才回被记录。 记录等级包括：

```
DEBUG
INFO
WARNING
ERROR
CRITICAL
```

默认等级是 `WARNING`。  

对于 format 用于处理记录信息的格式， 比如`%(message)s %(asctime)s`. 利用老旧的`%s`的原因是为了兼容之前的版本， 可以在之后的设置中使用新的`{`风格。  

logger 存在高低层关系， 底层的 logger 产生的信息会上传到父层中。


对于 logger， 有多种配置方式， 主要由两种， 基于 conf 的， 和使用代码的， 这里只总结了使用代码的。  

### logger
 logger 通过 getLogger 函数得到， 可以在不同的模块中使用不同的 logger

```python
import logging
logger = logging.getLogger(__name__)
logger.debug('some infomation')
```

### Handler
handler 有多种， 可以记录到 console， 或者到文件， 文件也可以自动 rotate， 常用的几个 handler

- StreamHandler。 打印到终端
- FileHandler  保存到文件
- RotatingFileHandler 保存到文件， 达到一定大小之后备份文件。
- TimedRotatingFileHandler 定时备份

其余参考 [useful-handlers](https://docs.python.org/3/howto/logging.html#useful-handlers)  

### formatter

Attribute name | Format | Description
--- | --- |:--- 
args | You shouldn’t need to format this yourself. | The tuple of arguments merged into msg to produce message, or a dict whose values are used for the merge (when there is only one argument, and it is a dictionary).
asctime | %(asctime)s | Human-readable time when the LogRecord was created. By default this is of the form ‘2003-07-08 16:49:45,896’ (the numbers after the comma are millisecond portion of the time).
created | %(created)f | Time when the LogRecord was created (as returned by time.time()).
exc_info | You shouldn’t need to format this yourself. | Exception tuple (à la sys.exc_info) or, if no exception has occurred, None.
filename | %(filename)s | Filename portion of pathname.
funcName | %(funcName)s | Name of function containing the logging call.
levelname | %(levelname)s | Text logging level for the message ('DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL').
levelno | %(levelno)s | Numeric logging level for the message (DEBUG, INFO, WARNING, ERROR, CRITICAL).
lineno | %(lineno)d | Source line number where the logging call was issued (if available).
module | %(module)s | Module (name portion of filename).
msecs | %(msecs)d | Millisecond portion of the time when the LogRecord was created.
message | %(message)s | The logged message, computed as msg % args. This is set when Formatter.format() is invoked.
msg | You shouldn’t need to format this yourself. | The format string passed in the original logging call. Merged with args to produce message, or an arbitrary object (see Using arbitrary objects as messages).
name | %(name)s | Name of the logger used to log the call.
pathname | %(pathname)s | Full pathname of the source file where the logging call was issued (if available).
process | %(process)d | Process ID (if available).
processName | %(processName)s | Process name (if available).
relativeCreated | %(relativeCreated)d | Time in milliseconds when the LogRecord was created, relative to the time the logging module was loaded.
stack_info | You shouldn’t need to format this yourself. | Stack frame information (where available) from the bottom of the stack in the current thread, up to and including the stack frame of the logging call which resulted in the creation of this record.
thread | %(thread)d | Thread ID (if available).
threadName | %(threadName)s | Thread name (if available).


### example

```python
logger = logging.getLogger(__name__)
formatter = logging.Formatter("[%(asctime)s][%(levelname)s][%(threadName)s][%(funcName)s] %(message)s")

file_handle = handlers.RotatingFileHandler('example.log', maxBytes=1024,
                                           backupCount=5)

err_handle = handlers.RotatingFileHandler('err.log', maxBytes=1024,
                                          backupCount=3)

file_handle.setLevel(logging.INFO)
file_handle.setFormatter(formatter)

err_handle.setLevel(logging.ERROR)
err_handle.setFormatter(formatter)

console_handle  = logging.StreamHandler()
console_handle.setLevel(logging.DEBUG)
console_handle.setFormatter(formatter)


logger.addHandler(file_handle)
logger.addHandler(console_handle)
logger.addHandler(err_handle)

```

#### reference
https://docs.python.org/3/library/logging.html 
https://docs.python.org/3/howto/logging.html

2017年08月02日17:20:48
