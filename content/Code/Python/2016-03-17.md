Title: Python Package Setup  
Tags: python, 小结  

esl_model <https://github.com/littlezz/ESL-Model>  
今天算是弄完了第三章的代码， 放到github上面， 折腾python的打包折腾了大半天。  

简单总结一下Python的Package Distribution吧。  
有空的话， 在写一个pytest的简单总结。


setup.py
----------
setup.py 是最主要的整个配置的文件， 


贴我的setup.py 的代码好了。  

```python  
from setuptools import setup, find_packages

with open('README.rst', 'r', encoding='utf8') as f:
    readme = f.read()

version = __import__('esl_model').__version__


setup(name='esl_model',
      version=version,
      description="Algorithm from The Elements of Statistical Learning book implement by Python code",
      long_description=readme,
      classifiers=[
          'Programming Language :: Python :: 3.5',
          'Programming Language :: Python :: 3 :: Only',
          'Development Status :: 2 - Pre-Alpha',
          'License :: OSI Approved :: MIT License',
      ],
      url='https://github.com/littlezz/ESL-Model',
      author='littlezz',
      author_email='zz.at.field@gmail.com',
      license='MIT',
      packages=find_packages(exclude=['tests*']),
      install_requires=[
            'numpy',
            'pandas',
            'scipy',
            'sklearn',
      ],
      tests_require=['pytest'],
      include_package_data=True,
      zip_safe=False,
)
```

逐个解释参数。  
`name` 是你要发布的模块的名字, 只能是用小写和下划线.不要和其他的公共的模块名字冲突.  

`version` 是版本号, 诸如 0.0.1 这样.  

`description` 和 `long_description`是你这个项目的介绍，用于pipy上面的介绍，注意 long_description 只能使用rst格式， **不支持**markdown。   

`classifiers`是你在pipy上面的分类， 一般在这里要只能你是否支持py2， 或py3， 或者是否有特定的平台限制。[所有classifiers 列表](https://pypi.python.org/pypi?%3Aaction=list_classifiers)  

`packages`, 要包含的代码的文件夹。比如我也可以设置成 `esl_model`， 但是据我观察， 这样设置之后， 我下面的子模块是没有办法使用`import esl_model.ch3` 这样载入的。  
所以使用find_packages自动寻找所有模块， 特别排除我的测试文件存放的文件夹。  

`install_requires`, 依赖， 如果在虚拟环境里面的话可以用`pip freeze`来查看安装的库， 但是这里面会包含真正用到的库（比如里面可能会显示ipython）。 可以使用 pipreqs 这个库。  

`tests_require` 这个是测试的用的, 在`python setup.py test`的时候用到, 然而我偷懒了, pytest在这里还差一步配置， 所以这里有没有都一样。。  

`include_package_data`, 这个是包含非python代码的文件， 我的程序里面要使用到csv数据， 所以需要这个选项。  

我的代码结构树

```  
── LICENSE.md
├── MANIFEST.in
├── README.rst
├── esl_model
│   ├── __init__.py
│   ├── __pycache__
│   ├── base.py
│   ├── ch3
│   │   ├── __init__.py
│   │   ├── __pycache__
│   │   └── model.py
│   ├── datasets
│   │   ├── __init__.py
│   │   ├── __pycache__
│   │   ├── base.py
│   │   └── data
│   │       └── prostate.csv
│   └── utils.py
├── pytest.ini
├── setup.py
└── tests
    ├── __init__.py
    ├── __pycache__
    ├── test_ch3.py
    └── utils.py

```  


MANIFEST.in
-----------
指定需要包含的非程序文件  

一般是`include README.rst`   
我这里因为有额外的数据， 所以要多一行。  

```
include README.rst
recursive-include esl_model/datasets/data *.csv
```

recursive-include 必须， 不然数据不包含。  

测试安装
--------
`pip install -e .`  
本地的调试安装模式。  


ref
------
- sklearn的配置文件 <https://github.com/scikit-learn/scikit-learn>  
- Python-packaging <https://python-packaging.readthedocs.org/en/latest/testing.html>
